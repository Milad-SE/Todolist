@model proj.Models.TodoViewModel
<div class="todo-container">
    <form asp-action="addTask" method="post">
        <div class="input-form">
            <input type="text" id="task-name-input" data-translatable-attr="placeholder"
                data-key-attr="taskNamePlaceholder" asp-for="NewTask.Name" placeholder="عنوان وظیفه (مثلاً: پروژه فردا)">
            <textarea id="task-desc-input" data-translatable-attr="placeholder" data-key-attr="taskDescPlaceholder"
                asp-for="NewTask.Description" placeholder="توضیحات کامل وظیفه و جزئیات..."></textarea>
            <button id="add-btn" data-translatable="true" data-key="addTaskBtn">اضافه کردن وظیفه</button>
        </div>
    </form>
    <ul id="todo-list">
        @foreach (var task in Model.Tasks)
        {
            <li class="@((task.Completed ? "completed" : ""))">
                <div class="task-content">
                    <div class="task-name">@task.Name</div>
                    <div class="task-description">@task.Description</div>
                </div>
                <div class="actions">
                    <form asp-action="ToggleComplete" method="post" style="display:inline;">
                        <input type="hidden" name="id" value="@task.Id" />
                        <button type="submit" class="action-btn complete-btn">✓</button>
                    </form>
                    <button class="action-btn edit-btn"><i class="fas fa-pen"></i></button>
                    <button class="action-btn save-btn">✓</button>
                    <form asp-action="DeleteTask" method="post" style="display:inline;">
                        <input type="hidden" name="id" value="@task.Id" />
                        <button type="submit" class="action-btn delete-btn">✕</button>
                    </form>
                </div>
            </li>
        }
    </ul>
</div>

<script>
    const translations = {
        headerTitle: { fa: 'لیست انجام کارهای من', en: 'My To-Do List' },
        headerIcon: { fa: '⭐', en: '⭐' },
        themeBtnText: { fa: 'حالت شب', en: 'Dark Mode' },
        langBtnText: { fa: 'English', en: 'فارسی' },
        addTaskBtn: { fa: 'اضافه کردن وظیفه', en: 'Add Task' },
        task1Name: { fa: 'طراحی رابط کاربری (UI/UX)', en: 'UI/UX Design' },
        task1Desc: { fa: 'بررسی فیدبک‌های کاربر و اعمال تغییرات نهایی در صفحه اصلی و پروفایل.', en: 'Review user feedback and finalize changes on the homepage and profile.' },
        task2Name: { fa: 'آماده‌سازی گزارش ماهیانه', en: 'Prepare Monthly Report' },
        task2Desc: { fa: 'جمع‌آوری داده‌های فروش و خلاصه‌سازی عملکرد سه ماهه آخر.', en: 'Gather sales data and summarize performance for the last quarter.' },
        task3NameHidden: { fa: 'این متن در حالت ویرایش دیده نمی‌شود', en: 'This text is hidden in edit mode' },
        task3DescHidden: { fa: 'توضیحات پنهان', en: 'Hidden description' },
        taskNamePlaceholder: { fa: 'عنوان وظیفه (مثلاً: پروژه فردا)', en: 'Task Title (e.g., Project Tomorrow)' },
        taskDescPlaceholder: { fa: 'توضیحات کامل وظیفه و جزئیات...', en: 'Full task description and details...' },
        completeTitle: { fa: 'تکمیل', en: 'Complete' },
        editTitle: { fa: 'ویرایش', en: 'Edit' },
        saveTitle: { fa: 'ذخیره', en: 'Save' },
        deleteTitle: { fa: 'حذف', en: 'Delete' },
        pageTitle: { fa: 'لیست انجام کارها', en: 'To-Do List' },
    };

    function updateLanguage(lang) {
        const html = document.documentElement;
        const body = document.body;
        const toggleBtn = document.getElementById('language-toggle');
        html.setAttribute('lang', lang);
        html.setAttribute('dir', lang === 'fa' ? 'rtl' : 'ltr');
        body.classList.remove('fa', 'en');
        body.classList.add(lang);

        document.querySelectorAll('[data-translatable="true"]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (translations[key] && translations[key][lang]) {
                el.textContent = translations[key][lang];
            }
        });

        document.querySelectorAll('[data-translatable-attr]').forEach(el => {
            const attr = el.getAttribute('data-translatable-attr');
            const key = el.getAttribute('data-key-attr');
            if (translations[key] && translations[key][lang]) {
                el.setAttribute(attr, translations[key][lang]);
            }
        });

        document.getElementById('page-title').textContent = translations.pageTitle[lang];

        toggleBtn.setAttribute('data-current-lang', lang);
        toggleBtn.querySelector('[data-key="langBtnText"]').textContent = lang === 'fa' ? 'English' : 'فارسی';

        const themeBtn = document.getElementById('theme-toggle');
        const themeBtnText = themeBtn.querySelector('[data-key="themeBtnText"]');

        const isDarkMode = body.classList.contains('dark-mode');
        if (themeBtnText) {
            if (lang === 'fa') {
                themeBtnText.textContent = isDarkMode ? 'حالت روز' : 'حالت شب';
            } else {
                themeBtnText.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
            }
        }

        localStorage.setItem('appLang', lang);
    }

    const savedLang = localStorage.getItem('appLang') || 'fa';
    updateLanguage(savedLang);

    document.getElementById('language-toggle').addEventListener('click', function () {
        const currentLang = this.getAttribute('data-current-lang');
        const newLang = currentLang === 'fa' ? 'en' : 'fa';
        updateLanguage(newLang);
    });

    document.getElementById('theme-toggle').addEventListener('click', function () {
        document.body.classList.toggle('dark-mode');

        const isDarkMode = document.body.classList.contains('dark-mode');
        const currentLang = document.getElementById('language-toggle').getAttribute('data-current-lang');

        const icon = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';

        const textFA = isDarkMode ? 'حالت روز' : 'حالت شب';
        const textEN = isDarkMode ? 'Light Mode' : 'Dark Mode';

        const themeBtnText = this.querySelector('[data-key="themeBtnText"]');

        if (themeBtnText) {
            themeBtnText.textContent = currentLang === 'fa' ? textFA : textEN;
        }

        this.querySelector('i').className = icon;
        localStorage.setItem('darkMode', isDarkMode ? 'true' : 'false');
    });

    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        const themeToggleBtn = document.getElementById('theme-toggle');
        themeToggleBtn.querySelector('i').className = 'fas fa-sun';
        const currentLang = document.getElementById('language-toggle').getAttribute('data-current-lang');
        const themeBtnText = themeToggleBtn.querySelector('[data-key="themeBtnText"]');
        if (themeBtnText) {
            themeBtnText.textContent = currentLang === 'fa' ? 'حالت روز' : 'Light Mode';
        }
    }
</script>